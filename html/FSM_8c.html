<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elevator: source/FSM.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elevator
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_b2f33c71d4aa5e7af42a1ca61ff5af1b.html">source</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">FSM.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implementation of funtions from <a class="el" href="FSM_8h.html" title="Headerfile for finite state machine.">FSM.h</a>.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="FSM_8h_source.html">FSM.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="timer_8h_source.html">timer.h</a>&quot;</code><br />
<code>#include &lt;assert.h&gt;</code><br />
<code>#include &quot;stdio.h&quot;</code><br />
</div>
<p><a href="FSM_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a022d8948e3b085f4a99ee5d112871535"><td class="memItemLeft" align="right" valign="top"><a id="a022d8948e3b085f4a99ee5d112871535"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SHOULD_UP</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a022d8948e3b085f4a99ee5d112871535"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b89540bc97e3b408f5ef208c96db230"><td class="memItemLeft" align="right" valign="top"><a id="a6b89540bc97e3b408f5ef208c96db230"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SHOULD_STAY</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a6b89540bc97e3b408f5ef208c96db230"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3599dde9cf9c48dfe0c4d45b91b08e0f"><td class="memItemLeft" align="right" valign="top"><a id="a3599dde9cf9c48dfe0c4d45b91b08e0f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SHOULD_DOWN</b>&#160;&#160;&#160;-1</td></tr>
<tr class="separator:a3599dde9cf9c48dfe0c4d45b91b08e0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b901b7f5fe255e94b2637c2262ce07b"><td class="memItemLeft" align="right" valign="top"><a id="a1b901b7f5fe255e94b2637c2262ce07b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NO_DECISION</b>&#160;&#160;&#160;-11</td></tr>
<tr class="separator:a1b901b7f5fe255e94b2637c2262ce07b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0943e7d593cc4be6c04b1d7c7bde59eb"><td class="memItemLeft" align="right" valign="top"><a id="a0943e7d593cc4be6c04b1d7c7bde59eb"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>printStates</b> ()</td></tr>
<tr class="separator:a0943e7d593cc4be6c04b1d7c7bde59eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bc68d2016b4febdd4e10280d44fc00a"><td class="memItemLeft" align="right" valign="top"><a id="a4bc68d2016b4febdd4e10280d44fc00a"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FSM_8c.html#a4bc68d2016b4febdd4e10280d44fc00a">FSM_init</a> ()</td></tr>
<tr class="memdesc:a4bc68d2016b4febdd4e10280d44fc00a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the finite state machine by setting all orders to 0, turning off all lamps, setting all elevariables to 0/neutral. If <code>floor_level</code> is not defind, the elevator wil go up and stop at a floor where it is defined. <br /></td></tr>
<tr class="separator:a4bc68d2016b4febdd4e10280d44fc00a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1685d9b5092a0f8d0532d717a1b97c65"><td class="memItemLeft" align="right" valign="top"><a id="a1685d9b5092a0f8d0532d717a1b97c65"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FSM_8c.html#a1685d9b5092a0f8d0532d717a1b97c65">FSM_updateBtnsAndLights</a> ()</td></tr>
<tr class="memdesc:a1685d9b5092a0f8d0532d717a1b97c65"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates <code>m_elevator_buttons</code> array with the new values from elevio. Only updates if there is not an active order. Also sets the corresponding buttonlights according to the array. <br  />
 <br /></td></tr>
<tr class="separator:a1685d9b5092a0f8d0532d717a1b97c65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96abfa3e222ba02c1d6941b50b07bab8"><td class="memItemLeft" align="right" valign="top"><a id="a96abfa3e222ba02c1d6941b50b07bab8"></a>
<a class="el" href="defines_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><b>FSM_orderAbovefloor</b> (int floor)</td></tr>
<tr class="separator:a96abfa3e222ba02c1d6941b50b07bab8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a870a813bbab66cb7643d05ede934deb8"><td class="memItemLeft" align="right" valign="top"><a id="a870a813bbab66cb7643d05ede934deb8"></a>
<a class="el" href="defines_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><b>FSM_orderBelowfloor</b> (int floor)</td></tr>
<tr class="separator:a870a813bbab66cb7643d05ede934deb8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40af9e55f4888bba9c8a5275fc1cf718"><td class="memItemLeft" align="right" valign="top"><a id="a40af9e55f4888bba9c8a5275fc1cf718"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>FSM_setDoor</b> (<a class="el" href="defines_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> open)</td></tr>
<tr class="separator:a40af9e55f4888bba9c8a5275fc1cf718"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1133a5afa9fc3cb9110a58bd4fe174e2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="defines_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FSM_8c.html#a1133a5afa9fc3cb9110a58bd4fe174e2">FSM_IdleTrigger</a> ()</td></tr>
<tr class="memdesc:a1133a5afa9fc3cb9110a58bd4fe174e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if the elevator should stop and to enter an Idle state. Is elevator on a floor with orders. If not and on a floor, update the <code>floor_level</code> variable to floor pluss/minus 0.5 depending on the direction.  <a href="FSM_8c.html#a1133a5afa9fc3cb9110a58bd4fe174e2">More...</a><br /></td></tr>
<tr class="separator:a1133a5afa9fc3cb9110a58bd4fe174e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8bf87dbb095817adaf314661370898b4"><td class="memItemLeft" align="right" valign="top"><a id="a8bf87dbb095817adaf314661370898b4"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FSM_8c.html#a8bf87dbb095817adaf314661370898b4">FSM_IdleEntry</a> ()</td></tr>
<tr class="memdesc:a8bf87dbb095817adaf314661370898b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Completes the routine that should be done everytime the elevator enter Idle state. That is to stop the motor, open the door, and remove orders on the floor and turn off their corresponding lights. <br /></td></tr>
<tr class="separator:a8bf87dbb095817adaf314661370898b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a948e60edcfa334e5a3ee2bd608d15c"><td class="memItemLeft" align="right" valign="top"><a id="a1a948e60edcfa334e5a3ee2bd608d15c"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FSM_8c.html#a1a948e60edcfa334e5a3ee2bd608d15c">FSM_EmergencyEntry</a> ()</td></tr>
<tr class="memdesc:a1a948e60edcfa334e5a3ee2bd608d15c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Completes the routine that should be done whenever emergency state is entered. Thid includes stoping the motor, turnin on the stoplamp, deleting all orders in the <code>m_elevator_buttons</code> array. If the elevator is on a floor, the door is also be opened. <br /></td></tr>
<tr class="separator:a1a948e60edcfa334e5a3ee2bd608d15c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ea7a668648f5b8404a13d1c88d0bc07"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FSM_8c.html#a0ea7a668648f5b8404a13d1c88d0bc07">FSM_IdleRoutine_decision</a> ()</td></tr>
<tr class="memdesc:a0ea7a668648f5b8404a13d1c88d0bc07"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates correct decision for elevator to be used in Idle state when makin a decition of what to do next. This loops throught the <code>m_elevator_buttons</code> array differently depending on what direction the elevator has. If the elevator has a direction up, it loops through the upper part of the array, and vice versa for direction down. If the elevator is in a nuetral direction, it loops through the array from the first floor and up (and return as soon as an order is found unless it is the floor you are). This means that floor lower floor levels will be prioritized. <br  />
  <a href="FSM_8c.html#a0ea7a668648f5b8404a13d1c88d0bc07">More...</a><br /></td></tr>
<tr class="separator:a0ea7a668648f5b8404a13d1c88d0bc07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad2a5a83f3ede046018b46b1f494812b"><td class="memItemLeft" align="right" valign="top"><a id="aad2a5a83f3ede046018b46b1f494812b"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FSM_8c.html#aad2a5a83f3ede046018b46b1f494812b">FSM_update</a> ()</td></tr>
<tr class="memdesc:aad2a5a83f3ede046018b46b1f494812b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates the finite-state machine by checking all the buttons, and then taking necessary decision in order to attain elevator criterium. This include setting differnt button lights, all the logic (decision making), and changing the state. <br /></td></tr>
<tr class="separator:aad2a5a83f3ede046018b46b1f494812b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation of funtions from <a class="el" href="FSM_8h.html" title="Headerfile for finite state machine.">FSM.h</a>. </p>

<p class="definition">Definition in file <a class="el" href="FSM_8c_source.html">FSM.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a0ea7a668648f5b8404a13d1c88d0bc07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ea7a668648f5b8404a13d1c88d0bc07">&#9670;&nbsp;</a></span>FSM_IdleRoutine_decision()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int FSM_IdleRoutine_decision </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generates correct decision for elevator to be used in Idle state when makin a decition of what to do next. This loops throught the <code>m_elevator_buttons</code> array differently depending on what direction the elevator has. If the elevator has a direction up, it loops through the upper part of the array, and vice versa for direction down. If the elevator is in a nuetral direction, it loops through the array from the first floor and up (and return as soon as an order is found unless it is the floor you are). This means that floor lower floor levels will be prioritized. <br  />
 </p>
<dl class="section return"><dt>Returns</dt><dd><code>SHOULD_UP</code> , <code>SHOULD_STAY</code> , <code>SHOULD_DOWN</code> or <code>NO_DECISION</code> depending on the current orders. </dd></dl>

<p class="definition">Definition at line <a class="el" href="FSM_8c_source.html#l00238">238</a> of file <a class="el" href="FSM_8c_source.html">FSM.c</a>.</p>

</div>
</div>
<a id="a1133a5afa9fc3cb9110a58bd4fe174e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1133a5afa9fc3cb9110a58bd4fe174e2">&#9670;&nbsp;</a></span>FSM_IdleTrigger()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="defines_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> FSM_IdleTrigger </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if the elevator should stop and to enter an Idle state. Is elevator on a floor with orders. If not and on a floor, update the <code>floor_level</code> variable to floor pluss/minus 0.5 depending on the direction. </p>
<dl class="section return"><dt>Returns</dt><dd><code>true</code> or <code>false</code> depending on whether the idle entry condition are met. </dd></dl>

<p class="definition">Definition at line <a class="el" href="FSM_8c_source.html#l00159">159</a> of file <a class="el" href="FSM_8c_source.html">FSM.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
